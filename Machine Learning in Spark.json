{"paragraphs":[{"text":"%md\nMachine Learning in Spark\n==================================\n","user":"anonymous","dateUpdated":"2018-11-23T15:42:10+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Machine Learning in Spark</h1>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702759_-1424188327","id":"20171103-004711_863647390","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T15:42:10+0000","dateFinished":"2018-11-23T15:42:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:24073"},{"text":"%md\n### Read data","user":"anonymous","dateUpdated":"2018-11-23T15:42:14+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Read data</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702760_-453290797","id":"20171103-004752_1311859387","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T15:42:14+0000","dateFinished":"2018-11-23T15:42:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24074"},{"text":"import org.apache.spark.sql.types._\n\nval df = spark.read.parquet(\"/data/train.parquet\").\n    select(\n        $\"Week\".cast(FloatType),\n        $\"SalesDepotID\".cast(FloatType),\n        $\"SalesChannelID\".cast(FloatType),\n        $\"RouteID\".cast(FloatType),\n        $\"ClientID\".cast(FloatType),\n        $\"ProductID\".cast(FloatType),\n        $\"Demand\".cast(FloatType)\n    )\n\ndf.show(7)","user":"anonymous","dateUpdated":"2018-11-23T15:42:31+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\ndf: org.apache.spark.sql.DataFrame = [Week: float, SalesDepotID: float ... 5 more fields]\n+----+------------+--------------+-------+--------+---------+------+\n|Week|SalesDepotID|SalesChannelID|RouteID|ClientID|ProductID|Demand|\n+----+------------+--------------+-------+--------+---------+------+\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  34213.0|   1.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  34255.0|   2.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  35571.0|   1.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  36711.0|  13.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  43118.0|   4.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  43197.0|   6.0|\n| 9.0|      1461.0|           1.0| 1201.0|831447.0|  43206.0|  35.0|\n+----+------------+--------------+-------+--------+---------+------+\nonly showing top 7 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=93","http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=94"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1542987702760_-740421957","id":"20171108-145128_360271297","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T15:42:31+0000","dateFinished":"2018-11-23T15:42:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24075"},{"text":"%md\n### Prepare data - Splitting data into train and validation with features","user":"anonymous","dateUpdated":"2018-11-23T15:44:08+0000","config":{"tableHide":true,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Prepare data - Splitting data into train and validation with features</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702760_761068717","id":"20171103-011055_1410887426","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T15:42:36+0000","dateFinished":"2018-11-23T15:42:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24076"},{"text":"// Use first 5 weeks as training data\nval trainDataPrep = df.\n    filter(!$\"Week\".isin(8, 9)).\n    drop($\"Week\")\n\n// Use last 2 weeks as validation data\nval valDataPrep = df.\n    filter($\"Week\".isin(8, 9)).\n    drop($\"Week\")\n    \ntrainDataPrep.show(7)","user":"anonymous","dateUpdated":"2018-11-23T15:42:55+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"trainDataPrep: org.apache.spark.sql.DataFrame = [SalesDepotID: float, SalesChannelID: float ... 4 more fields]\nvalDataPrep: org.apache.spark.sql.DataFrame = [SalesDepotID: float, SalesChannelID: float ... 4 more fields]\n+------------+--------------+-------+--------+---------+------+\n|SalesDepotID|SalesChannelID|RouteID|ClientID|ProductID|Demand|\n+------------+--------------+-------+--------+---------+------+\n|      1471.0|           1.0| 1617.0|179031.0|  36598.0|   1.0|\n|      1471.0|           1.0| 1617.0|179031.0|  43040.0|   5.0|\n|      1471.0|           1.0| 1617.0|179031.0|  45111.0|   9.0|\n|      1471.0|           1.0| 1617.0|179031.0|  45112.0|   9.0|\n|      1471.0|           1.0| 1617.0|179036.0|   3718.0|   3.0|\n|      1471.0|           1.0| 1617.0|179036.0|  43000.0|   5.0|\n|      1471.0|           1.0| 1617.0|179036.0|  43040.0|   2.0|\n+------------+--------------+-------+--------+---------+------+\nonly showing top 7 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=95"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1542987702760_-101086092","id":"20171103-011135_965466670","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T15:42:55+0000","dateFinished":"2018-11-23T15:42:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24077"},{"text":"%md\n### Prepare features in vector assembler","user":"anonymous","dateUpdated":"2018-11-23T15:44:31+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Prepare features in vector assembler</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987836469_-912196859","id":"20181123-154356_491374906","dateCreated":"2018-11-23T15:43:56+0000","dateStarted":"2018-11-23T15:44:31+0000","dateFinished":"2018-11-23T15:44:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24078"},{"text":"import org.apache.spark.ml.evaluation.RegressionEvaluator\nimport org.apache.spark.ml.regression.{RandomForestRegressionModel, RandomForestRegressor}\nimport org.apache.spark.ml.feature.VectorAssembler\n\n// Index features\nval assembler = new VectorAssembler().\n  setInputCols(Array(\"SalesDepotID\", \"SalesChannelID\", \"RouteID\", \"ClientID\", \"ProductID\")).\n  setOutputCol(\"assembledFeatures\")\n\n// Train Data\nval trainData = assembler.\n    transform(trainDataPrep.limit(10000)).\n    show()","user":"anonymous","dateUpdated":"2018-11-23T16:01:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.ml.evaluation.RegressionEvaluator\nimport org.apache.spark.ml.regression.{RandomForestRegressionModel, RandomForestRegressor}\nimport org.apache.spark.ml.feature.VectorAssembler\nassembler: org.apache.spark.ml.feature.VectorAssembler = vecAssembler_3074dc19cb9d\n+------------+--------------+-------+--------+---------+------+--------------------+\n|SalesDepotID|SalesChannelID|RouteID|ClientID|ProductID|Demand|   assembledFeatures|\n+------------+--------------+-------+--------+---------+------+--------------------+\n|      1471.0|           1.0| 1617.0|179031.0|  36598.0|   1.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179031.0|  43040.0|   5.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179031.0|  45111.0|   9.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179031.0|  45112.0|   9.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|   3718.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|  43000.0|   5.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|  43040.0|   2.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|  43215.0|   2.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|  45111.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|179036.0|  45112.0|   4.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|180051.0|   3718.0|   2.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|180051.0|  43061.0|   4.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|180051.0|  45111.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|180051.0|  45112.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|181680.0|   3718.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|181680.0|  32861.0|   2.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|181680.0|  43040.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|181680.0|  45111.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|181680.0|  45112.0|   3.0|[1471.0,1.0,1617....|\n|      1471.0|           1.0| 1617.0|182127.0|   3718.0|   2.0|[1471.0,1.0,1617....|\n+------------+--------------+-------+--------+---------+------+--------------------+\nonly showing top 20 rows\n\ntrainData: Unit = ()\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=103"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1542987702761_-1228167399","id":"20171111-094418_1983379275","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T16:01:20+0000","dateFinished":"2018-11-23T16:01:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24079"},{"text":"%md\n### Prepare train data and val data","user":"anonymous","dateUpdated":"2018-11-23T15:45:00+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Prepare train data and val data</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987886043_173457825","id":"20181123-154446_2145846478","dateCreated":"2018-11-23T15:44:46+0000","dateStarted":"2018-11-23T15:45:00+0000","dateFinished":"2018-11-23T15:45:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24080"},{"text":"import org.apache.spark.ml.evaluation.RegressionEvaluator\nimport org.apache.spark.ml.regression.{RandomForestRegressionModel, RandomForestRegressor}\nimport org.apache.spark.ml.feature.VectorAssembler\n\n// Index features\nval assembler = new VectorAssembler().\n  setInputCols(Array(\"SalesDepotID\", \"SalesChannelID\", \"RouteID\", \"ClientID\", \"ProductID\")).\n  setOutputCol(\"assembledFeatures\")\n\n// Train Data\nval trainData = assembler.\n    transform(trainDataPrep).\n    select(\n        \"assembledFeatures\",\n        \"Demand\"\n    ).\n    repartition(100)\n\n// Validation Data\nval valData = assembler.\n    transform(valDataPrep).\n    select(\n        \"assembledFeatures\",\n        \"Demand\"\n    )","user":"anonymous","dateUpdated":"2018-11-23T16:01:45+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"msg":[{"data":"","type":"TEXT"}]},"apps":[],"jobName":"paragraph_1542987702761_-1841966320","id":"20171103-014037_846422168","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T16:01:45+0000","dateFinished":"2018-11-23T16:01:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24081","errorMessage":""},{"text":"%md\n\n### Build Random Forest model","user":"anonymous","dateUpdated":"2018-11-23T15:47:22+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Build Random Forest model</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542988027444_438320603","id":"20181123-154707_1623567911","dateCreated":"2018-11-23T15:47:07+0000","dateStarted":"2018-11-23T15:47:22+0000","dateFinished":"2018-11-23T15:47:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24082"},{"text":"// Train a RandomForest regression model\nval rf = new RandomForestRegressor().\n    setLabelCol(\"Demand\").\n    setFeaturesCol(\"assembledFeatures\").\n    setNumTrees(5).\n    setMaxDepth(3)\n\n// Train model\nval model = rf.fit(trainData)\n","user":"anonymous","dateUpdated":"2018-11-23T16:22:47+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1542987702762_-1851358432","id":"20171108-150536_1692339097","dateCreated":"2018-11-23T15:41:42+0000","dateStarted":"2018-11-23T16:22:47+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24083","dateFinished":"2018-11-23T16:42:27+0000","results":{"msg":[{"data":"","type":"TEXT"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=127","http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=128","http://ip-172-31-50-132.ec2.internal:4040/jobs/job?id=129"],"interpreterSettingId":"spark"}}},{"text":"// Make predictions\nval predictions = model.transform(valData)\n\n// Select example rows to display\npredictions.show(5)\n","user":"anonymous","dateUpdated":"2018-11-23T16:38:02+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1542987702763_-662800687","id":"20171108-151139_831636425","dateCreated":"2018-11-23T15:41:42+0000","status":"ABORT","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24084","dateStarted":"2018-11-23T16:36:48+0000"},{"text":"%md\n### Evaluate Model - RMSE","user":"anonymous","dateUpdated":"2018-11-23T16:37:55+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Evaluate Model - RMSE</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702763_1277367986","id":"20171103-011539_1334990513","dateCreated":"2018-11-23T15:41:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24085","dateFinished":"2018-11-23T16:37:55+0000","dateStarted":"2018-11-23T16:37:55+0000"},{"text":"// Evaluate model\nval evaluator = new RegressionEvaluator().\n    setLabelCol(\"Demand\").\n    setPredictionCol(\"prediction\").\n    setMetricName(\"rmse\")\n  \nval rmse = evaluator.evaluate(predictions)\n\nprintln(\"Root Mean Squared Error (RMSE) on validation data = \" + rmse)\n","user":"anonymous","dateUpdated":"2018-11-23T15:49:11+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nevaluator: org.apache.spark.ml.evaluation.RegressionEvaluator = regEval_5dbef4926f7d\n\nrmse: Double = 52.08608480189111\nRoot Mean Squared Error (RMSE) on validation data = 52.08608480189111\n"}]},"apps":[],"jobName":"paragraph_1542987702763_196292955","id":"20171103-014605_1511230027","dateCreated":"2018-11-23T15:41:42+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24086"},{"text":"%md\n### Feature Engineering - Count features\neg: count of ProductID","user":"anonymous","dateUpdated":"2018-11-23T16:39:03+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Feature Engineering - Count features</h3>\n<p>eg: count of ProductID</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702763_-2054110123","id":"20171103-011751_792924665","dateCreated":"2018-11-23T15:41:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24087","dateFinished":"2018-11-23T16:39:03+0000","dateStarted":"2018-11-23T16:39:03+0000"},{"text":"val product_count = df.\n    groupBy($\"ProductID\").\n    count()\n    \nval df2 = df.\n    join(product_count, Seq(\"ProductID\"), \"inner\")\n\ndf2.show","user":"anonymous","dateUpdated":"2018-11-23T16:45:30+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nproduct_count: org.apache.spark.sql.DataFrame = [ProductID: float, count: bigint]\n\ndf2: org.apache.spark.sql.DataFrame = [ProductID: float, Week: float ... 6 more fields]\n+---------+----+------------+--------------+-------+---------+------+-----+\n|ProductID|Week|SalesDepotID|SalesChannelID|RouteID| ClientID|Demand|count|\n+---------+----+------------+--------------+-------+---------+------+-----+\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 108322.0|   3.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 184834.0|  14.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 221805.0|   2.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 221970.0|   1.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 290608.0|  31.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 534163.0|   6.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0| 842107.0|   1.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0|4297345.0|   7.0|  820|\n|    714.0| 6.0|      1239.0|           1.0| 1025.0|4307111.0|   1.0|  820|\n|    714.0| 6.0|      1259.0|           6.0| 3234.0|4382853.0|   1.0|  820|\n|    714.0| 6.0|      1259.0|           6.0| 3234.0|4491952.0|   1.0|  820|\n|    714.0| 6.0|      1259.0|           7.0| 3335.0|1218356.0|   4.0|  820|\n|    714.0| 6.0|      1259.0|           7.0| 3344.0|1836766.0|   6.0|  820|\n|    714.0| 6.0|      1259.0|           7.0| 3344.0|2391826.0|   9.0|  820|\n|    714.0| 6.0|      1259.0|           7.0| 3349.0|4354559.0|  16.0|  820|\n|    714.0| 6.0|      1259.0|           7.0| 3356.0| 110787.0|   4.0|  820|\n|    714.0| 6.0|      1259.0|           8.0| 3402.0| 856474.0|   5.0|  820|\n|    714.0| 6.0|      1259.0|          11.0| 3502.0|2449896.0|   2.0|  820|\n|    714.0| 6.0|      1279.0|           7.0| 3323.0|4471234.0|  30.0|  820|\n|    714.0| 6.0|      1279.0|           7.0| 3328.0|4428788.0|  12.0|  820|\n+---------+----+------------+--------------+-------+---------+------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1542987702764_838498725","id":"20171103-011914_1186536867","dateCreated":"2018-11-23T15:41:42+0000","status":"ABORT","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24088"},{"text":"%md\n### Feature Engineering - Lag features\neg: Demand of Client and Product in previous week","user":"anonymous","dateUpdated":"2018-11-23T16:39:18+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Feature Engineering - Lag features</h3>\n<p>eg: Demand of Client and Product in previous week</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702764_-1028277910","id":"20171103-012331_2113070645","dateCreated":"2018-11-23T15:41:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24089","dateFinished":"2018-11-23T16:39:18+0000","dateStarted":"2018-11-23T16:39:18+0000"},{"text":"import org.apache.spark.sql.functions.{lead, lag}\nimport org.apache.spark.sql.expressions.Window\n\n// Previous week demand of product for client\nval prev_df = df.\n    groupBy($\"ProductID\", $\"ClientID\", $\"Week\").\n    agg(\n        sum($\"Demand\") as \"Prev_Demand\"\n    ).\n    withColumn(\"Week\", $\"Week\" + lit(1))\n    \nval df3 = df.\n    join(prev_df, Seq(\"ProductID\", \"ClientID\", \"Week\"), \"left\")\n","user":"anonymous","dateUpdated":"2018-11-23T16:45:42+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.spark.sql.functions.{lead, lag}\n\nimport org.apache.spark.sql.expressions.Window\n\nprev_df: org.apache.spark.sql.DataFrame = [ProductID: float, ClientID: float ... 2 more fields]\n\ndf3: org.apache.spark.sql.DataFrame = [ProductID: float, ClientID: float ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1542987702764_-1478735629","id":"20171103-034903_2044464037","dateCreated":"2018-11-23T15:41:42+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24090"},{"text":"// Previous occurrence of demand of product in any week\nval df4 = df.\n    withColumn(\"Prev_Demand2\", lag($\"Demand\", 1).over(Window.partitionBy(\"ProductID\", \"ClientID\").orderBy(\"Week\")))\n    ","user":"anonymous","dateUpdated":"2018-11-23T15:41:42+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndf4: org.apache.spark.sql.DataFrame = [Week: float, SalesDepotID: float ... 6 more fields]\n"}]},"apps":[],"jobName":"paragraph_1542987702765_1406728482","id":"20171109-074755_1659039894","dateCreated":"2018-11-23T15:41:42+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24091"},{"text":"%md\n### Feature Engineering\nTry out your own feature ideas!","user":"anonymous","dateUpdated":"2018-11-23T16:40:14+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true,"completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"fontSize":9,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Feature Engineering</h3>\n<p>Try out your own feature ideas!</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1542987702766_161275372","id":"20171103-024506_153450945","dateCreated":"2018-11-23T15:41:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:24094","dateFinished":"2018-11-23T16:40:14+0000","dateStarted":"2018-11-23T16:40:14+0000"},{"user":"anonymous","dateUpdated":"2018-11-23T15:41:42+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1542987702766_-300241402","id":"20171111-101052_438657210","dateCreated":"2018-11-23T15:41:42+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:24097"}],"name":"Machine Learning in Spark","id":"2DVQFUUWP","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}